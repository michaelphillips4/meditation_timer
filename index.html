<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>meditation timer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://orca1.orca-tools.com/orca.min.css" />
    <meta name="description" content="A Meditation Timer." />
  </head>

  <body>
    <header>
      <h1 class="center">Meditation Timer</h1>
    </header>

    <main>

<p>
      <audio controls id="meditation_chime">
        <source src="section.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
      
</p>

      <input
        type="range"
        step="1"
        min="0"
        value="10"
        max="60"
        id="stage"
        onchange="rangeChange()"
      />
      <div>minutes <span id="minutes">10</span></div>
      <button onclick="add()">Add</button>

      <ol id="stagesList"></ol>
      <div id="timer"></div>
      <button onclick="start()">Start</button>
    </main>

    <script>
      let stages = [];
      const chime = document.getElementById("meditation_chime");
      const stagesList = document.getElementById("stagesList");
      const stage = document.getElementById("stage");

      const showStages = () => {
        stagesList.innerHTML = "";
        stages.map((e) => displayStage(e));
      };

      const displayStage = (stage) => {
        const li = document.createElement("li");
        li.innerText = stage;
        stagesList.appendChild(li);
      };

      const addStage = () => {
        console.log("addStage");
        stages.push(parseInt(stage.value));
      };

      const add = () => {
        addStage();
        showStages();
      };

      const rangeChange = () => {
        document.getElementById("minutes").innerText = stage.value;
      };

      const start = () => {
        timer();
        // stages.forEach((e) => timer(e));
      };

      const timer = () => {
        // console.log(duration,stages);

        let time = 0;
       
        const totalTime = stages.reduce((x, y) => x + y, 0);
     

        let timer = setInterval(() => {
          
          let sectionIndex = 0;
             let sectionTime = stages[sectionIndex];
          document.getElementById(
            "timer"
          ).innerHTML = `${sectionIndex} : ${time}`;
         
          console.log(sectionIndex, time);

          if (sectionTime == time) {
            sectionIndex++;
            sectionTime += stage[sectionIndex];
            //section ended 
            chime.play();
          }
          if (time >= totalTime) {
           
            console.log(time, "cleared");
            document.getElementById("timer").innerHTML = "finished"; 
            clearInterval(timer);
            // finished 
          }
           time++;
        }, 1000);
      };

    

      
    </script>
  </body>
</html>
